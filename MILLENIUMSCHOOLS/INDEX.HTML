<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Fee Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            position: relative; 
            background: #ecfdf5;
        }
        .container { 
            max-width: 1280px; 
            margin: 0 auto; 
            padding: 1.5rem; 
            position: relative; 
            z-index: 10; 
        }
        .card { 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 0.75rem; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); 
        }
        .nav-button { 
            transition: all 0.3s; 
        }
        .nav-button:hover { 
            transform: translateY(-2px); 
        }
        .table-header { 
            background: #dbeafe; 
        }
        .table-row:hover { 
            background: #eff6ff; 
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4f46e5, #10b981);
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeOut 0.5s ease-in-out 1.5s forwards;
            z-index: 1000;
        }
        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }
        .splash-logo {
            animation: scaleIn 0.5s ease-in-out;
            max-width: 300px;
            max-height: 300px;
        }
        @keyframes scaleIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('logo.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
            opacity: 0.05;
            pointer-events: none;
            z-index: 1;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-open {
            transform: translateX(0);
        }
        .sidebar-closed {
            transform: translateX(-100%);
        }
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                width: 80%;
                max-width: 300px;
                z-index: 20;
            }
            .main-content {
                margin-left: 0;
            }
        }
        @media (min-width: 769px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                width: 300px;
            }
            .main-content {
                margin-left: 300px;
            }
        }
        @media print {
            .no-print { display: none; }
            .print-receipt { 
                display: block !important; 
                position: static;
                width: 210mm;
                height: 297mm;
                margin: 0 auto;
                padding: 20mm;
                border: 2px solid #000;
                background: #fff;
                background-image: url('logo.png');
                background-repeat: no-repeat;
                background-position: center;
                background-size: 60%;
                opacity: 1;
                box-sizing: border-box;
            }
            .print-receipt .watermark-logo {
                opacity: 0.1;
            }
            .print-table {
                border-collapse: collapse;
                width: 100%;
            }
            .print-table th, .print-table td {
                border: 1px solid #000;
                padding: 10px;
                text-align: left;
            }
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body className="bg-emerald-50">
    <div className="watermark"></div>
    <div id="root"></div>

    <script type="text/babel">
        // Utility functions for localStorage
        const loadData = (key, defaultValue) => {
            localStorage.clear();
            return defaultValue;
        };

        const saveData = (key, data) => {
            localStorage.setItem(key, JSON.stringify(data));
        };

        // Initialize default classes
        const initialClasses = Array.from({ length: 10 }, (_, i) => ({
            id: `Class ${i + 1}`,
            dayScholarFee: 0,
            hostelStudentFee: 0,
            students: []
        }));

        // Main App Component
        function App() {
            const [classes, setClasses] = React.useState(loadData('classes', initialClasses));
            const [expenses, setExpenses] = React.useState(loadData('expenses', []));
            const [currentTab, setCurrentTab] = React.useState('dashboard');
            const [showSplash, setShowSplash] = React.useState(true);
            const [isSidebarOpen, setIsSidebarOpen] = React.useState(false);

            // Handle splash screen
            React.useEffect(() => {
                const timer = setTimeout(() => {
                    setShowSplash(false);
                }, 2000);
                return () => clearTimeout(timer);
            }, []);

            // Save data to localStorage on changes
            React.useEffect(() => {
                saveData('classes', classes);
                saveData('expenses', expenses);
            }, [classes, expenses]);

            // Fee Calculations
            const totalIncome = classes.reduce((sum, cls) =>
                sum + cls.students.reduce((acc, student) =>
                    acc + (student.payments ? student.payments.reduce((sum, p) => sum + p.amount, 0) : 0), 0), 0);

            const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const remainingBalance = totalIncome - totalExpenses;

            // Toggle Sidebar
            const toggleSidebar = () => {
                setIsSidebarOpen(!isSidebarOpen);
            };

            // Handle Fee Configuration
            const handleSetFees = (classId, dayScholarFee, hostelStudentFee) => {
                if (dayScholarFee < 0 || hostelStudentFee < 0) {
                    alert('Fees cannot be negative.');
                    return;
                }
                setClasses(classes.map(cls =>
                    cls.id === classId ? { ...cls, dayScholarFee, hostelStudentFee } : cls
                ));
            };

            // Handle Add Student
            const handleAddStudent = (classId, studentName, studentType, concession = 0) => {
                const cls = classes.find(c => c.id === classId);
                if (!cls.dayScholarFee && !cls.hostelStudentFee) {
                    alert(`Please set fees for ${classId} before adding students.`);
                    return;
                }
                if (!studentName.trim()) {
                    alert('Please enter a student name.');
                    return;
                }
                const baseFee = studentType === 'Day Scholar' ? cls.dayScholarFee : cls.hostelStudentFee;
                if (concession < 0 || concession > baseFee) {
                    alert(`Concession must be between 0 and ₹${baseFee}.`);
                    return;
                }
                const feeAfterConcession = baseFee - concession;
                const newStudent = {
                    id: `${classId}-${Date.now()}`,
                    name: studentName,
                    type: studentType,
                    feeAmount: baseFee,
                    concession: concession,
                    feeAfterConcession: feeAfterConcession,
                    remainingBalance: feeAfterConcession,
                    payments: [],
                    paymentStatus: 'Pending',
                    enrollmentDate: new Date().toISOString().split('T')[0]
                };
                setClasses(classes.map(cls =>
                    cls.id === classId ? { ...cls, students: [...cls.students, newStudent] } : cls
                ));
            };

            // Handle Partial Payment
            const handleAddPayment = (classId, studentId, amount) => {
                if (!amount || amount <= 0) {
                    alert('Please enter a valid payment amount.');
                    return;
                }
                setClasses(classes.map(cls =>
                    cls.id === classId ? {
                        ...cls,
                        students: cls.students.map(student =>
                            student.id === studentId ? {
                                ...student,
                                payments: [...(student.payments || []), {
                                    id: Date.now(),
                                    amount: parseFloat(amount),
                                    date: new Date().toISOString().split('T')[0]
                                }],
                                remainingBalance: Math.max(0, student.remainingBalance - parseFloat(amount)),
                                paymentStatus: student.remainingBalance - parseFloat(amount) <= 0 ? 'Paid' : 'Pending'
                            } : student
                        )
                    } : cls
                ));
            };

            // Handle Add Expense
            const handleAddExpense = (itemName, amount, date) => {
                if (!itemName.trim() || !amount || !date) {
                    alert('Please fill all fields.');
                    return;
                }
                if (amount < 0) {
                    alert('Amount cannot be negative.');
                    return;
                }
                setExpenses([...expenses, { id: Date.now(), itemName, amount: parseFloat(amount), date }]);
            };

            // Handle Print Receipt
            const handlePrintReceipt = (classId, studentId) => {
                window.print();
            };

            // Chart Component
            function FinanceChart() {
                const chartRef = React.useRef(null);
                const chartInstance = React.useRef(null);

                React.useEffect(() => {
                    if (chartRef.current) {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                        chartInstance.current = new Chart(chartRef.current, {
                            type: 'bar',
                            data: {
                                labels: ['Income', 'Expenses'],
                                datasets: [{
                                    label: 'Financial Overview (₹)',
                                    data: [totalIncome, totalExpenses],
                                    backgroundColor: ['#4f46e5', '#f43f5e'],
                                    borderColor: ['#3b82f6', '#e11d48'],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Amount (₹)'
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    title: {
                                        display: true,
                                        text: 'Income vs Expenses'
                                    }
                                },
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                    };
                }, [totalIncome, totalExpenses]);

                return (
                    <div className="card p-4 h-64">
                        <canvas ref={chartRef}></canvas>
                    </div>
                );
            }

            // Sidebar Component
            function Sidebar() {
                return (
                    <div className={`sidebar bg-white w-64 md:w-80 p-4 h-full card no-print ${isSidebarOpen ? 'sidebar-open' : 'sidebar-closed'} md:sidebar-open`}>
                        <div className="flex justify-between items-center mb-4 md:hidden">
                            <h2 className="text-xl font-bold text-gray-800">Financial Overview</h2>
                            <button onClick={toggleSidebar} className="text-gray-600">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <FinanceChart />
                    </div>
                );
            }

            // Splash Screen Component
            function SplashScreen() {
                return (
                    <div className="splash-screen no-print">
                        <img 
                            src="logo.png" 
                            alt="School Logo" 
                            className="splash-logo"
                            onError={(e) => {
                                e.target.src = 'https://via.placeholder.com/300x300.png?text=School+Logo';
                            }}
                        />
                    </div>
                );
            }

            // Fee Receipt Component
            function FeeReceipt({ cls, student }) {
                const latestPayment = student.payments && student.payments.length > 0 
                    ? student.payments[student.payments.length - 1] 
                    : { amount: 0, date: 'N/A' };

                return (
                    <div className="print-receipt hidden">
                        <div className="flex justify-between items-center mb-8">
                            <div>
                                <h2 className="text-4xl font-bold text-gray-800">MILLENIUM SCHOOLS</h2>
                                <p className="text-gray-600 text-lg">123 Education Lane, City, Country</p>
                            </div>
                            <img 
                                src="logo.png" 
                                alt="School Logo" 
                                className="w-32 h-32 watermark-logo"
                                onError={(e) => {
                                    e.target.src = 'https://via.placeholder.com/100x100.png?text=School+Logo';
                                }}
                            />
                        </div>
                        <div className="border-t-2 border-b-2 border-gray-300 py-4 mb-8">
                            <h3 className="text-2xl font-semibold text-gray-700">Fee Receipt</h3>
                            <p className="text-lg"><strong>Receipt Date:</strong> {new Date().toISOString().split('T')[0]}</p>
                        </div>
                        <div className="mb-8">
                            <h3 className="text-xl font-semibold text-gray-700 mb-3">Student Details</h3>
                            <div className="grid grid-cols-2 gap-3">
                                <p><strong>Name:</strong> {student.name}</p>
                                <p><strong>Class:</strong> {cls.id}</p>
                                <p><strong>Type:</strong> {student.type}</p>
                                <p><strong>Enrollment Date:</strong> {student.enrollmentDate}</p>
                            </div>
                        </div>
                        <div className="mb-8">
                            <h3 className="text-xl font-semibold text-gray-700 mb-3">Fee Summary</h3>
                            <table className="print-table">
                                <tbody>
                                    <tr>
                                        <td className="font-semibold">Total Fee</td>
                                        <td>₹{student.feeAmount}</td>
                                    </tr>
                                    <tr>
                                        <td className="font-semibold">Concession</td>
                                        <td>₹{student.concession}</td>
                                    </tr>
                                    <tr>
                                        <td className="font-semibold">Fee After Concession</td>
                                        <td>₹{student.feeAfterConcession}</td>
                                    </tr>
                                    <tr>
                                        <td className="font-semibold">Total Paid</td>
                                        <td>₹{student.payments ? student.payments.reduce((sum, p) => sum + p.amount, 0) : 0}</td>
                                    </tr>
                                    <tr>
                                        <td className="font-semibold">Latest Payment</td>
                                        <td>₹{latestPayment.amount} {latestPayment.date !== 'N/A' ? `on ${latestPayment.date}` : ''}</td>
                                    </tr>
                                    <tr>
                                        <td className="font-semibold">Remaining Balance</td>
                                        <td>₹{student.remainingBalance}</td>
                                    </tr>
                                    <tr>
                                        <td className="font-semibold">Payment Status</td>
                                        <td>{student.paymentStatus}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div className="mb-8">
                            <h3 className="text-xl font-semibold text-gray-700 mb-3">Payment History</h3>
                            {student.payments && student.payments.length > 0 ? (
                                <table className="print-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {student.payments.map(payment => (
                                            <tr key={payment.id}>
                                                <td>{payment.date}</td>
                                                <td>₹{payment.amount}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            ) : (
                                <p>No payments made</p>
                            )}
                        </div>
                        <div className="text-center text-gray-500">
                            <p>Thank you for your payment!</p>
                            <p>This is a computer-generated receipt</p>
                        </div>
                    </div>
                );
            }

            // Class Management Component
            function ClassManagement() {
                const [classId, setClassId] = React.useState('Class 1');
                const [dayScholarFee, setDayScholarFee] = React.useState('');
                const [hostelStudentFee, setHostelStudentFee] = React.useState('');

                const handleSubmit = () => {
                    handleSetFees(classId, parseFloat(dayScholarFee) || 0, parseFloat(hostelStudentFee) || 0);
                    setDayScholarFee('');
                    setHostelStudentFee('');
                };

                return (
                    <div className="card p-6 mb-8 no-print">
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">Class & Fee Management</h2>
                        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
                            <select
                                value={classId}
                                onChange={(e) => setClassId(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            >
                                {classes.map(cls => (
                                    <option key={cls.id} value={cls.id}>{cls.id}</option>
                                ))}
                            </select>
                            <input
                                type="number"
                                placeholder="Day Scholar Fee"
                                value={dayScholarFee}
                                onChange={(e) => setDayScholarFee(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <input
                                type="number"
                                placeholder="Hostel Student Fee"
                                value={hostelStudentFee}
                                onChange={(e) => setHostelStudentFee(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <button
                                onClick={handleSubmit}
                                className="bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700 nav-button"
                            >
                                Set Fees
                            </button>
                        </div>
                        <h3 className="text-xl font-semibold text-gray-700 mt-6">Class Fee Overview</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full mt-4 border">
                                <thead className="table-header">
                                    <tr>
                                        <th className="p-3 text-left">Class</th>
                                        <th className="p-3 text-left">Day Scholar Fee</th>
                                        <th className="p-3 text-left">Hostel Student Fee</th>
                                        <th className="p-3 text-left">Students</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {classes.map(cls => (
                                        <tr key={cls.id} className="table-row">
                                            <td className="p-3 border">{cls.id}</td>
                                            <td className="p-3 border">₹{cls.dayScholarFee}</td>
                                            <td className="p-3 border">₹{cls.hostelStudentFee}</td>
                                            <td className="p-3 border">{cls.students.length}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            }

            // Student Management Component
            function StudentManagement() {
                const [classId, setClassId] = React.useState('Class 1');
                const [studentName, setStudentName] = React.useState('');
                const [studentType, setStudentType] = React.useState('Day Scholar');
                const [concession, setConcession] = React.useState('');

                const handleSubmit = () => {
                    handleAddStudent(classId, studentName, studentType, parseFloat(concession) || 0);
                    setStudentName('');
                    setStudentType('Day Scholar');
                    setConcession('');
                };

                return (
                    <div className="card p-6 mb-8 no-print">
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">Add Student</h2>
                        <div className="grid grid-cols-1 gap-4 sm:grid-cols-4">
                            <select
                                value={classId}
                                onChange={(e) => setClassId(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            >
                                {classes.map(cls => (
                                    <option key={cls.id} value={cls.id}>{cls.id}</option>
                                ))}
                            </select>
                            <input
                                type="text"
                                placeholder="Student Name"
                                value={studentName}
                                onChange={(e) => setStudentName(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <select
                                value={studentType}
                                onChange={(e) => setStudentType(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            >
                                <option value="Day Scholar">Day Scholar</option>
                                <option value="Hostel Student">Hostel Student</option>
                            </select>
                            <input
                                type="number"
                                placeholder="Concession (₹)"
                                value={concession}
                                onChange={(e) => setConcession(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                                min="0"
                            />
                            <button
                                onClick={handleSubmit}
                                className="bg-amber-500 text-white p-3 rounded-lg hover:bg-amber-600 nav-button"
                            >
                                Add Student
                            </button>
                        </div>
                    </div>
                );
            }

            // Fee Management Component
            function FeeManagement() {
                const [paymentInputs, setPaymentInputs] = React.useState({});

                const handlePaymentInputChange = (studentId, value) => {
                    setPaymentInputs({ ...paymentInputs, [studentId]: value });
                };

                const handleSubmitPayment = (classId, studentId) => {
                    const amount = paymentInputs[studentId];
                    handleAddPayment(classId, studentId, amount);
                    setPaymentInputs({ ...paymentInputs, [studentId]: '' });
                };

                return (
                    <div className="no-print">
                        <div className="card p-6 mb-8">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">Fee Management</h2>
                            {classes.map(cls => (
                                <div key={cls.id} className="mb-6">
                                    <h3 className="text-xl font-semibold text-gray-700 mb-3">{cls.id} - Student Details</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full border">
                                            <thead className="table-header">
                                                <tr>
                                                    <th className="p-3 text-left">Student Name</th>
                                                    <th className="p-3 text-left">Type</th>
                                                    <th className="p-3 text-left">Total Fee</th>
                                                    <th className="p-3 text-left">Concession (₹)</th>
                                                    <th className="p-3 text-left">Fee After Concession</th>
                                                    <th className="p-3 text-left">Paid</th>
                                                    <th className="p-3 text-left">Remaining</th>
                                                    <th className="p-3 text-left">Status</th>
                                                    <th className="p-3 text-left">Enrollment Date</th>
                                                    <th className="p-3 text-left">Add Payment</th>
                                                    <th className="p-3 text-left">Payment History</th>
                                                    <th className="p-3 text-left">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {cls.students.length > 0 ? (
                                                    cls.students.map(student => (
                                                        <tr key={student.id} className="table-row">
                                                            <td className="p-3 border">{student.name}</td>
                                                            <td className="p-3 border">{student.type}</td>
                                                            <td className="p-3 border">₹{student.feeAmount}</td>
                                                            <td className="p-3 border">₹{student.concession}</td>
                                                            <td className="p-3 border">₹{student.feeAfterConcession}</td>
                                                            <td className="p-3 border">₹{student.payments ? student.payments.reduce((sum, p) => sum + p.amount, 0) : 0}</td>
                                                            <td className="p-3 border">₹{student.remainingBalance}</td>
                                                            <td className="p-3 border">
                                                                <span className={`px-2 py-1 rounded ${student.paymentStatus === 'Paid' ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'}`}>
                                                                    {student.paymentStatus}
                                                                </span>
                                                            </td>
                                                            <td className="p-3 border">{student.enrollmentDate}</td>
                                                            <td className="p-3 border">
                                                                <div className="flex gap-2">
                                                                    <input
                                                                        type="number"
                                                                        placeholder="Amount"
                                                                        value={paymentInputs[student.id] || ''}
                                                                        onChange={(e) => handlePaymentInputChange(student.id, e.target.value)}
                                                                        className="p-2 border rounded-lg w-24"
                                                                    />
                                                                    <button
                                                                        onClick={() => handleSubmitPayment(cls.id, student.id)}
                                                                        className="bg-emerald-500 text-white p-2 rounded-lg hover:bg-emerald-600"
                                                                    >
                                                                        Add
                                                                    </button>
                                                                </div>
                                                            </td>
                                                            <td className="p-3 border">
                                                                {student.payments && student.payments.length > 0 ? (
                                                                    <ul className="list-disc pl-4">
                                                                        {student.payments.map(payment => (
                                                                            <li key={payment.id}>
                                                                                ₹{payment.amount} on {payment.date}
                                                                            </li>
                                                                        ))}
                                                                    </ul>
                                                                ) : (
                                                                    'No payments'
                                                                )}
                                                            </td>
                                                            <td className="p-3 border">
                                                                <button
                                                                    onClick={() => handlePrintReceipt(cls.id, student.id)}
                                                                    className="bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600"
                                                                >
                                                                    Print Receipt
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))
                                                ) : (
                                                    <tr>
                                                        <td colSpan="12" className="p-3 text-center text-gray-500">No students in this class</td>
                                                    </tr>
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="mt-3 bg-gray-50 p-4 rounded-lg">
                                        <p><strong>Total Students:</strong> {cls.students.length}</p>
                                        <p><strong>Total Fees:</strong> ₹{cls.students.reduce((sum, s) => sum + s.feeAfterConcession, 0)}</p>
                                        <p><strong>Paid:</strong> ₹{cls.students.reduce((sum, s) => sum + (s.payments ? s.payments.reduce((sum, p) => sum + p.amount, 0) : 0), 0)}</p>
                                        <p><strong>Pending:</strong> ₹{cls.students.reduce((sum, s) => sum + s.remainingBalance, 0)}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                        {classes.map(cls => (
                            cls.students.map(student => (
                                <FeeReceipt key={student.id} cls={cls} student={student} />
                            ))
                        ))}
                    </div>
                );
            }

            // Expense Management Component
            function ExpenseManagement() {
                const [itemName, setItemName] = React.useState('');
                const [amount, setAmount] = React.useState('');
                const [date, setDate] = React.useState('');

                const handleSubmit = () => {
                    handleAddExpense(itemName, amount, date);
                    setItemName('');
                    setAmount('');
                    setDate('');
                };

                return (
                    <div className="card p-6 mb-8 no-print">
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">Expense Management</h2>
                        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
                            <input
                                type="text"
                                placeholder="Item Name"
                                value={itemName}
                                onChange={(e) => setItemName(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <input
                                type="number"
                                placeholder="Amount"
                                value={amount}
                                onChange={(e) => setAmount(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <input
                                type="date"
                                value={date}
                                onChange={(e) => setDate(e.target.value)}
                                className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            />
                            <button
                                onClick={handleSubmit}
                                className="bg-rose-500 text-white p-3 rounded-lg hover:bg-rose-600 nav-button"
                            >
                                Add Expense
                            </button>
                        </div>
                        <h3 className="text-xl font-semibold text-gray-700 mt-6">Expenses</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full mt-4 border">
                                <thead className="table-header">
                                    <tr>
                                        <th className="p-3 text-left">Date</th>
                                        <th className="p-3 text-left">Item Name</th>
                                        <th className="p-3 text-left">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map(expense => (
                                        <tr key={expense.id} className="table-row">
                                            <td className="p-3 border">{expense.date}</td>
                                            <td className="p-3 border">{expense.itemName}</td>
                                            <td className="p-3 border">₹{expense.amount}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <p className="mt-4 text-lg"><strong>Total Expenses:</strong> ₹{totalExpenses}</p>
                    </div>
                );
            }

            // Dashboard Component
            function Dashboard() {
                return (
                    <div className="card p-6 no-print">
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">Dashboard</h2>
                        <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
                            <div className="card p-4 bg-indigo-100">
                                <h3 className="text-lg font-semibold text-indigo-800">Total Income</h3>
                                <p className="text-2xl font-bold text-indigo-900">₹{totalIncome}</p>
                            </div>
                            <div className="card p-4 bg-rose-100">
                                <h3 className="text-lg font-semibold text-rose-800">Total Expenses</h3>
                                <p className="text-2xl font-bold text-rose-900">₹{totalExpenses}</p>
                            </div>
                            <div className="card p-4 bg-emerald-100">
                                <h3 className="text-lg font-semibold text-emerald-800">Remaining Balance</h3>
                                <p className="text-2xl font-bold text-emerald-900">₹{remainingBalance}</p>
                            </div>
                        </div>
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Class-wise Fee Report</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full mb-8 border">
                                <thead className="table-header">
                                    <tr>
                                        <th className="p-3 text-left">Class</th>
                                        <th className="p-3 text-left">Total Students</th>
                                        <th className="p-3 text-left">Total Fees</th>
                                        <th className="p-3 text-left">Paid</th>
                                        <th className="p-3 text-left">Pending</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {classes.map(cls => (
                                        <tr key={cls.id} className="table-row">
                                            <td className="p-3 border">{cls.id}</td>
                                            <td className="p-3 border">{cls.students.length}</td>
                                            <td className="p-3 border">₹{cls.students.reduce((sum, s) => sum + s.feeAfterConcession, 0)}</td>
                                            <td className="p-3 border">₹{cls.students.reduce((sum, s) => sum + (s.payments ? s.payments.reduce((sum, p) => sum + p.amount, 0) : 0), 0)}</td>
                                            <td className="p-3 border">₹{cls.students.reduce((sum, s) => sum + s.remainingBalance, 0)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Student-wise Fee Report</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full mb-8 border">
                                <thead className="table-header">
                                    <tr>
                                        <th className="p-3 text-left">Class</th>
                                        <th className="p-3 text-left">Student Name</th>
                                        <th className="p-3 text-left">Type</th>
                                        <th className="p-3 text-left">Total Fee</th>
                                        <th className="p-3 text-left">Concession (₹)</th>
                                        <th className="p-3 text-left">Fee After Concession</th>
                                        <th className="p-3 text-left">Paid</th>
                                        <th className="p-3 text-left">Remaining</th>
                                        <th className="p-3 text-left">Status</th>
                                        <th className="p-3 text-left">Enrollment Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {classes.flatMap(cls =>
                                        cls.students.map(student => (
                                            <tr key={student.id} className="table-row">
                                                <td className="p-3 border">{cls.id}</td>
                                                <td className="p-3 border">{student.name}</td>
                                                <td className="p-3 border">{student.type}</td>
                                                <td className="p-3 border">₹{student.feeAmount}</td>
                                                <td className="p-3 border">₹{student.concession}</td>
                                                <td className="p-3 border">₹{student.feeAfterConcession}</td>
                                                <td className="p-3 border">₹{student.payments ? student.payments.reduce((sum, p) => sum + p.amount, 0) : 0}</td>
                                                <td className="p-3 border">₹{student.remainingBalance}</td>
                                                <td className="p-3 border">
                                                    <span className={`px-2 py-1 rounded ${student.paymentStatus === 'Paid' ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'}`}>
                                                        {student.paymentStatus}
                                                    </span>
                                                </td>
                                                <td className="p-3 border">{student.enrollmentDate}</td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Date-wise Expense Report</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full border">
                                <thead className="table-header">
                                    <tr>
                                        <th className="p-3 text-left">Date</th>
                                        <th className="p-3 text-left">Item Name</th>
                                        <th className="p-3 text-left">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map(expense => (
                                        <tr key={expense.id} className="table-row">
                                            <td className="p-3 border">{expense.date}</td>
                                            <td className="p-3 border">{expense.itemName}</td>
                                            <td className="p-3 border">₹{expense.amount}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            }

            return (
                <>
                    {showSplash && <SplashScreen />}
                    {!showSplash && (
                        <div className="flex flex-col md:flex-row">
                            <Sidebar />
                            <div className="main-content container mx-auto p-4">
                                <button 
                                    onClick={toggleSidebar} 
                                    className="md:hidden mb-4 bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 no-print"
                                >
                                    {isSidebarOpen ? 'Hide Chart' : 'Show Chart'}
                                </button>
                                <h1 className="text-3xl font-bold text-gray-800 mb-6">School Fee Management System</h1>
                                <nav className="mb-6 flex flex-wrap gap-2 no-print">
                                    {['dashboard', 'class', 'student', 'fee', 'expense'].map(tab => (
                                        <button
                                            key={tab}
                                            onClick={() => setCurrentTab(tab)}
                                            className={`nav-button px-4 py-2 rounded-lg font-semibold ${currentTab === tab ? 'bg-indigo-600 text-white' : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'}`}
                                        >
                                            {tab.charAt(0).toUpperCase() + tab.slice(1)}
                                        </button>
                                    ))}
                                </nav>
                                {currentTab === 'dashboard' && <Dashboard />}
                                {currentTab === 'class' && <ClassManagement />}
                                {currentTab === 'student' && <StudentManagement />}
                                {currentTab === 'fee' && <FeeManagement />}
                                {currentTab === 'expense' && <ExpenseManagement />}
                            </div>
                        </div>
                    )}
                </>
            );
        }

        // Render the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>